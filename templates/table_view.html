{% extends "base.html" %}

{% block title %}興行収入データベース{% endblock %}

{% block content %}

<h2>興行収入データベース</h2>

<!-- 検索フォーム -->
<form method="get" style="margin-bottom: 20px;">
    年: <input type="text" name="year" value="{{ request.args.get('year', '') }}">
    タイトル: <input type="text" name="title" value="{{ request.args.get('title', '') }}">
    配給会社: <input type="text" name="distributor" value="{{ request.args.get('distributor', '') }}">
    <br><br>
    興収（億円）: <input type="text" name="min_revenue" placeholder="最小" value="{{ request.args.get('min_revenue', '') }}">
    ～ <input type="text" name="max_revenue" placeholder="最大" value="{{ request.args.get('max_revenue', '') }}">
    <br><br>
    監督名: <input type="text" name="director" value="{{ request.args.get('director', '') }}">
    キャスト名: <input type="text" name="actor" value="{{ request.args.get('actor', '') }}">
    <input type="submit" value="検索" class="button">
</form>

<!-- カード表示への切り替えリンク -->
<div style="margin-bottom: 10px;">
    <a href="{{ url_for('search') }}"
       style="padding: 6px 12px; background-color: #f5f5f5; border-radius: 6px; color: #333; text-decoration: none; border: 1px solid #ccc;">
       カード表示に切り替え
    </a>
</div>

<!-- 並び替え -->
<table style="width: 100%; border-collapse: collapse; background-color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
    <thead>
        <tr style="background-color: #f0f0f0;">
            <th style="padding: 10px; border: 1px solid #ccc;">
                <a href="{{ url_for('table_view', order_by='year', sort='asc') }}">年</a>
            </th>
            <th style="padding: 10px; border: 1px solid #ccc;">
                <a href="{{ url_for('table_view', order_by='release_date', sort='asc') }}">公開日</a>
            </th>
            <th style="padding: 10px; border: 1px solid #ccc;">
                <a href="{{ url_for('table_view', order_by='title', sort='asc') }}">作品名</a>
            </th>
            <th style="padding: 10px; border: 1px solid #ccc;">
                <a href="{{ url_for('table_view', order_by='revenue', sort='desc') }}">興収(億円)</a>
            </th>
            <th style="padding: 10px; border: 1px solid #ccc;">
                <a href="{{ url_for('table_view', order_by='category', sort='asc') }}">区分</a>
            </th>
            <th style="padding: 10px; border: 1px solid #ccc;">
                <a href="{{ url_for('table_view', order_by='distributor', sort='asc') }}">配給会社</a>
            </th>
        </tr>
    </thead>
    <tbody>
        {% for m in movies %}
        <tr>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ m.year }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ m.release_date }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">
                <a href="{{ url_for('movie_detail', movie_id=m.id) }}">{{ m.title }}</a>
            </td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ m.revenue }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ m.category }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ m.distributor }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if not movies %}
<div style="text-align: center; padding: 40px; color: #666;">
    <h3>検索結果が見つかりませんでした</h3>
    <p>検索条件を変更して再度お試しください。</p>
</div>
{% endif %}

<div style="text-align: center; margin-top: 20px;">
    {% if pagination.has_prev %}
        <a href="{{ url_for('table_view', page=pagination.prev_num) }}" 
           style="margin: 0 10px; text-decoration: none; color: #1a73e8;">← 前へ</a>
    {% endif %}
    <span>ページ {{ pagination.page }} / {{ pagination.pages }}</span>
    {% if pagination.has_next %}
        <a href="{{ url_for('table_view', page=pagination.next_num) }}" 
           style="margin: 0 10px; text-decoration: none; color: #1a73e8;">次へ →</a>
    {% endif %}
</div>

{% endblock %}